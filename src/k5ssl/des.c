/*
 * Copyright (c) 2006
 * The Regents of the University of Michigan
 * ALL RIGHTS RESERVED
 *
 * Permission is granted to use, copy, create derivative works
 * and redistribute this software and such derivative works
 * for any purpose, so long as the name of the University of
 * Michigan is not used in any advertising or publicity
 * pertaining to the use or distribution of this software
 * without specific, written prior authorization.  If the
 * above copyright notice or any other identification of the
 * University of Michigan is included in any copy of any
 * portion of this software, then the disclaimer below must
 * also be included.
 *
 * This software is provided as is, without representation
 * from the University of Michigan as to its fitness for any
 * purpose, and without warranty by the University of
 * Michigan of any kind, either express or implied, including
 * without limitation the implied warranties of
 * merchantability and fitness for a particular purpose.  The
 * regents of the University of Michigan shall not be liable
 * for any damages, including special, indirect, incidental, or
 * consequential damages, with respect to any claim arising
 * out of or in connection with the use of the software, even
 * if it has been or is hereafter advised of the possibility of
 * such damages.
 */

/* this code put together by:
 *	Marcus Watts, June 2006.
 * this would not exist without these people's ideas:
 *	Dan Hoey
 *	Jim Gillogly & Phil Karn
 *	Dennis Ferguson, Eric Young and Dana How
 *	John Fletcher
 *	Richard Outerbridge
 *	Dr B. R. Gladman
 */

#include "k5s_des.h"

#ifndef GETWORD
#define GETWORD(p,w)	((w) = (3[p] + (((unsigned int)2[p])<<8) + (((unsigned int)1[p])<<16) + (((unsigned int)0[p])<<24)))
#endif
#ifndef PUTWORD
#define PUTWORD(p,w)	((3[p] = w), (2[p] = (w >> 8)), (1[p] = (w>>16)), (0[p] = (w>>24)))
#endif

#ifndef _MSC_VER
#define rotr(x,n)   (((x) >> ((int)(n))) | ((x) << (32 - (int)(n))))
#define rotl(x,n)   (((x) << ((int)(n))) | ((x) >> (32 - (int)(n))))
#else
#include <stdlib.h>
#pragma intrinsic(_lrotr,_lrotl)
#define rotr(x,n)   _lrotr(x,n)
#define rotl(x,n)   _lrotl(x,n)
#endif

#define bs(a,b,n,m) ((t = ((a>>n) ^ b) & m),b^=t,a^=(t<<n))

/* 0 8 16 24 4 12 20 28 33 41 49 57 1 9 17 25
   34 42 50 58 2 10 18 26 35 43 51 59 3 11 19 27
   32 40 48 56 36 44 52 60 39 47 55 63 7 15 23 31
   38 46 54 62 6 14 22 30 37 45 53 61 5 13 21 29 */
#define IKP(c,d) \
bs(c,c,7,0xaa00aa), \
bs(d,d,7,0xaa00aa), \
bs(c,c,14,0xcccc), \
bs(d,d,14,0xcccc), \
bs(c,d,4,0xf0f0f00), \
bs(d,d,16,0xff00), \
bs(c,d,0,0xffffff00)
/* d &= ~15, c &= ~15 */

/* c & f = keybits 0,8,16,24 */
/* d & f = keybits 32,40,48,56 */

#define NKP(d,c) (d >>= 1, d |= ((d&8)<<28), c >>= 1, c |= ((c&8) << 28))
#define NNKP(d,c) (d >>= 2, d |= ((d&12)<<28), c >>= 2, c |= ((c&12) << 28))

/* for c bits 4 5 7 8 9 10 */
const static unsigned int K2S0[] = {
    0x0,0x1000,0x1,0x1001,
    0x100,0x1100,0x101,0x1101,
    0x4,0x1004,0x5,0x1005,
    0x104,0x1104,0x105,0x1105,
    0x20000,0x21000,0x20001,0x21001,
    0x20100,0x21100,0x20101,0x21101,
    0x20004,0x21004,0x20005,0x21005,
    0x20104,0x21104,0x20105,0x21105,
    0x20000000,0x20001000,0x20000001,0x20001001,
    0x20000100,0x20001100,0x20000101,0x20001101,
    0x20000004,0x20001004,0x20000005,0x20001005,
    0x20000104,0x20001104,0x20000105,0x20001105,
    0x20020000,0x20021000,0x20020001,0x20021001,
    0x20020100,0x20021100,0x20020101,0x20021101,
    0x20020004,0x20021004,0x20020005,0x20021005,
    0x20020104,0x20021104,0x20020105,0x20021105,
};
/* for c bits 11 12 13 14 16 17 */
const static unsigned int K2S1[] = {
    0x0,0x800,0x10000,0x10800,
    0x2000000,0x2000800,0x2010000,0x2010800,
    0x2,0x802,0x10002,0x10802,
    0x2000002,0x2000802,0x2010002,0x2010802,
    0x40000,0x40800,0x50000,0x50800,
    0x2040000,0x2040800,0x2050000,0x2050800,
    0x40002,0x40802,0x50002,0x50802,
    0x2040002,0x2040802,0x2050002,0x2050802,
    0x400,0xc00,0x10400,0x10c00,
    0x2000400,0x2000c00,0x2010400,0x2010c00,
    0x402,0xc02,0x10402,0x10c02,
    0x2000402,0x2000c02,0x2010402,0x2010c02,
    0x40400,0x40c00,0x50400,0x50c00,
    0x2040400,0x2040c00,0x2050400,0x2050c00,
    0x40402,0x40c02,0x50402,0x50c02,
    0x2040402,0x2040c02,0x2050402,0x2050c02,
};
/* for c bits 19 20 21 22 24 25 */
const static unsigned int K2S2[] = {
    0x0,0x8,0x10000000,0x10000008,
    0x2000,0x2008,0x10002000,0x10002008,
    0x100000,0x100008,0x10100000,0x10100008,
    0x102000,0x102008,0x10102000,0x10102008,
    0x20,0x28,0x10000020,0x10000028,
    0x2020,0x2028,0x10002020,0x10002028,
    0x100020,0x100028,0x10100020,0x10100028,
    0x102020,0x102028,0x10102020,0x10102028,
    0x4000000,0x4000008,0x14000000,0x14000008,
    0x4002000,0x4002008,0x14002000,0x14002008,
    0x4100000,0x4100008,0x14100000,0x14100008,
    0x4102000,0x4102008,0x14102000,0x14102008,
    0x4000020,0x4000028,0x14000020,0x14000028,
    0x4002020,0x4002028,0x14002020,0x14002028,
    0x4100020,0x4100028,0x14100020,0x14100028,
    0x4102020,0x4102028,0x14102020,0x14102028,
};
/* for c bits 26 27 28 29 30 31 */
const static unsigned int K2S3[] = {
    0x0,0x200000,0x200,0x200200,
    0x1000000,0x1200000,0x1000200,0x1200200,
    0x10,0x200010,0x210,0x200210,
    0x1000010,0x1200010,0x1000210,0x1200210,
    0x80000,0x280000,0x80200,0x280200,
    0x1080000,0x1280000,0x1080200,0x1280200,
    0x80010,0x280010,0x80210,0x280210,
    0x1080010,0x1280010,0x1080210,0x1280210,
    0x8000000,0x8200000,0x8000200,0x8200200,
    0x9000000,0x9200000,0x9000200,0x9200200,
    0x8000010,0x8200010,0x8000210,0x8200210,
    0x9000010,0x9200010,0x9000210,0x9200210,
    0x8080000,0x8280000,0x8080200,0x8280200,
    0x9080000,0x9280000,0x9080200,0x9280200,
    0x8080010,0x8280010,0x8080210,0x8280210,
    0x9080010,0x9280010,0x9080210,0x9280210,
};
/* for d bits 4 6 7 8 9 10 */
const static unsigned int K2S4[] = {
    0x0,0x400,0x2,0x402,
    0x80000,0x80400,0x80002,0x80402,
    0x10000000,0x10000400,0x10000002,0x10000402,
    0x10080000,0x10080400,0x10080002,0x10080402,
    0x200,0x600,0x202,0x602,
    0x80200,0x80600,0x80202,0x80602,
    0x10000200,0x10000600,0x10000202,0x10000602,
    0x10080200,0x10080600,0x10080202,0x10080602,
    0x10000,0x10400,0x10002,0x10402,
    0x90000,0x90400,0x90002,0x90402,
    0x10010000,0x10010400,0x10010002,0x10010402,
    0x10090000,0x10090400,0x10090002,0x10090402,
    0x10200,0x10600,0x10202,0x10602,
    0x90200,0x90600,0x90202,0x90602,
    0x10010200,0x10010600,0x10010202,0x10010602,
    0x10090200,0x10090600,0x10090202,0x10090602,
};
/* for d bits 11 12 13 14 15 16 */
const static unsigned int K2S5[] = {
    0x0,0x20000000,0x4,0x20000004,
    0x100,0x20000100,0x104,0x20000104,
    0x4000000,0x24000000,0x4000004,0x24000004,
    0x4000100,0x24000100,0x4000104,0x24000104,
    0x100000,0x20100000,0x100004,0x20100004,
    0x100100,0x20100100,0x100104,0x20100104,
    0x4100000,0x24100000,0x4100004,0x24100004,
    0x4100100,0x24100100,0x4100104,0x24100104,
    0x1,0x20000001,0x5,0x20000005,
    0x101,0x20000101,0x105,0x20000105,
    0x4000001,0x24000001,0x4000005,0x24000005,
    0x4000101,0x24000101,0x4000105,0x24000105,
    0x100001,0x20100001,0x100005,0x20100005,
    0x100101,0x20100101,0x100105,0x20100105,
    0x4100001,0x24100001,0x4100005,0x24100005,
    0x4100101,0x24100101,0x4100105,0x24100105,
};
/* for d bits 18 19 20 21 22 23 */
const static unsigned int K2S6[] = {
    0x0,0x1000000,0x800,0x1000800,
    0x8,0x1000008,0x808,0x1000808,
    0x20000,0x1020000,0x20800,0x1020800,
    0x20008,0x1020008,0x20808,0x1020808,
    0x2000,0x1002000,0x2800,0x1002800,
    0x2008,0x1002008,0x2808,0x1002808,
    0x22000,0x1022000,0x22800,0x1022800,
    0x22008,0x1022008,0x22808,0x1022808,
    0x8000000,0x9000000,0x8000800,0x9000800,
    0x8000008,0x9000008,0x8000808,0x9000808,
    0x8020000,0x9020000,0x8020800,0x9020800,
    0x8020008,0x9020008,0x8020808,0x9020808,
    0x8002000,0x9002000,0x8002800,0x9002800,
    0x8002008,0x9002008,0x8002808,0x9002808,
    0x8022000,0x9022000,0x8022800,0x9022800,
    0x8022008,0x9022008,0x8022808,0x9022808,
};
/* for d bits 24 25 31 27 28 29 */
const static unsigned int K2S7[] = {
    0x0,0x200000,0x1000,0x201000,
    0x20,0x200020,0x1020,0x201020,
    0x10,0x200010,0x1010,0x201010,
    0x30,0x200030,0x1030,0x201030,
    0x40000,0x240000,0x41000,0x241000,
    0x40020,0x240020,0x41020,0x241020,
    0x40010,0x240010,0x41010,0x241010,
    0x40030,0x240030,0x41030,0x241030,
    0x2000000,0x2200000,0x2001000,0x2201000,
    0x2000020,0x2200020,0x2001020,0x2201020,
    0x2000010,0x2200010,0x2001010,0x2201010,
    0x2000030,0x2200030,0x2001030,0x2201030,
    0x2040000,0x2240000,0x2041000,0x2241000,
    0x2040020,0x2240020,0x2041020,0x2241020,
    0x2040010,0x2240010,0x2041010,0x2241010,
    0x2040030,0x2240030,0x2041030,0x2241030,
};

int
des_setkey(des_key *ks,const unsigned char *k,int l)
{
    unsigned int c, d, t, e, f;
    unsigned int *s;
    int i;
    if (l != 8) return 666;
    s = ks->s;
    GETWORD(k, c); GETWORD(k+4, d);
    IKP(d,c);
    for (i = 16513;; i >>= 1) {
	e = K2S0[((c>>4)&3)|((c>>5)&60)] |
	    K2S1[((c>>11)&15)|((c>>12)&48)] |
	    K2S2[((c>>19)&15)|((c>>20)&48)] |
	    K2S3[((c>>26)&63)];
	f = K2S4[((d>>4)&1)|((d>>5)&62)] |
	    K2S5[((d>>11)&63)] |
	    K2S6[((d>>18)&63)] |
	    K2S7[((d>>24)&59)|((d>>29)&4)];
	t = f;
	f &= ~0xffff;
	f |= e >>16;
	e &= 0xffff;
	e |= t << 16;

	s[0] = e;
	s[1] = f;

	if (!i) break;
	s += 2;
	if (i & 1) {
	    NKP(d,c);
	} else {
	    NNKP(d,c);
	}
    }
    return 0;
}

const static unsigned int SP1[] = {
    0x1010400, 0x0, 0x10000, 0x1010404,
    0x1010004, 0x10404, 0x4, 0x10000,
    0x400, 0x1010400, 0x1010404, 0x400,
    0x1000404, 0x1010004, 0x1000000, 0x4,
    0x404, 0x1000400, 0x1000400, 0x10400,
    0x10400, 0x1010000, 0x1010000, 0x1000404,
    0x10004, 0x1000004, 0x1000004, 0x10004,
    0x0, 0x404, 0x10404, 0x1000000,
    0x10000, 0x1010404, 0x4, 0x1010000,
    0x1010400, 0x1000000, 0x1000000, 0x400,
    0x1010004, 0x10000, 0x10400, 0x1000004,
    0x400, 0x4, 0x1000404, 0x10404,
    0x1010404, 0x10004, 0x1010000, 0x1000404,
    0x1000004, 0x404, 0x10404, 0x1010400,
    0x404, 0x1000400, 0x1000400, 0x0,
    0x10004, 0x10400, 0x0, 0x1010004,
};

const static unsigned int SP2[] = {
    0x80108020, 0x80008000, 0x8000, 0x108020,
    0x100000, 0x20, 0x80100020, 0x80008020,
    0x80000020, 0x80108020, 0x80108000, 0x80000000,
    0x80008000, 0x100000, 0x20, 0x80100020,
    0x108000, 0x100020, 0x80008020, 0x0,
    0x80000000, 0x8000, 0x108020, 0x80100000,
    0x100020, 0x80000020, 0x0, 0x108000,
    0x8020, 0x80108000, 0x80100000, 0x8020,
    0x0, 0x108020, 0x80100020, 0x100000,
    0x80008020, 0x80100000, 0x80108000, 0x8000,
    0x80100000, 0x80008000, 0x20, 0x80108020,
    0x108020, 0x20, 0x8000, 0x80000000,
    0x8020, 0x80108000, 0x100000, 0x80000020,
    0x100020, 0x80008020, 0x80000020, 0x100020,
    0x108000, 0x0, 0x80008000, 0x8020,
    0x80000000, 0x80100020, 0x80108020, 0x108000,
};

const static unsigned int SP3[] = {
    0x208, 0x8020200, 0x0, 0x8020008,
    0x8000200, 0x0, 0x20208, 0x8000200,
    0x20008, 0x8000008, 0x8000008, 0x20000,
    0x8020208, 0x20008, 0x8020000, 0x208,
    0x8000000, 0x8, 0x8020200, 0x200,
    0x20200, 0x8020000, 0x8020008, 0x20208,
    0x8000208, 0x20200, 0x20000, 0x8000208,
    0x8, 0x8020208, 0x200, 0x8000000,
    0x8020200, 0x8000000, 0x20008, 0x208,
    0x20000, 0x8020200, 0x8000200, 0x0,
    0x200, 0x20008, 0x8020208, 0x8000200,
    0x8000008, 0x200, 0x0, 0x8020008,
    0x8000208, 0x20000, 0x8000000, 0x8020208,
    0x8, 0x20208, 0x20200, 0x8000008,
    0x8020000, 0x8000208, 0x208, 0x8020000,
    0x20208, 0x8, 0x8020008, 0x20200,
};

const static unsigned int SP4[] = {
    0x802001, 0x2081, 0x2081, 0x80,
    0x802080, 0x800081, 0x800001, 0x2001,
    0x0, 0x802000, 0x802000, 0x802081,
    0x81, 0x0, 0x800080, 0x800001,
    0x1, 0x2000, 0x800000, 0x802001,
    0x80, 0x800000, 0x2001, 0x2080,
    0x800081, 0x1, 0x2080, 0x800080,
    0x2000, 0x802080, 0x802081, 0x81,
    0x800080, 0x800001, 0x802000, 0x802081,
    0x81, 0x0, 0x0, 0x802000,
    0x2080, 0x800080, 0x800081, 0x1,
    0x802001, 0x2081, 0x2081, 0x80,
    0x802081, 0x81, 0x1, 0x2000,
    0x800001, 0x2001, 0x802080, 0x800081,
    0x2001, 0x2080, 0x800000, 0x802001,
    0x80, 0x800000, 0x2000, 0x802080,
};

const static unsigned int SP5[] = {
    0x100, 0x2080100, 0x2080000, 0x42000100,
    0x80000, 0x100, 0x40000000, 0x2080000,
    0x40080100, 0x80000, 0x2000100, 0x40080100,
    0x42000100, 0x42080000, 0x80100, 0x40000000,
    0x2000000, 0x40080000, 0x40080000, 0x0,
    0x40000100, 0x42080100, 0x42080100, 0x2000100,
    0x42080000, 0x40000100, 0x0, 0x42000000,
    0x2080100, 0x2000000, 0x42000000, 0x80100,
    0x80000, 0x42000100, 0x100, 0x2000000,
    0x40000000, 0x2080000, 0x42000100, 0x40080100,
    0x2000100, 0x40000000, 0x42080000, 0x2080100,
    0x40080100, 0x100, 0x2000000, 0x42080000,
    0x42080100, 0x80100, 0x42000000, 0x42080100,
    0x2080000, 0x0, 0x40080000, 0x42000000,
    0x80100, 0x2000100, 0x40000100, 0x80000,
    0x0, 0x40080000, 0x2080100, 0x40000100,
};

const static unsigned int SP6[] = {
    0x20000010, 0x20400000, 0x4000, 0x20404010,
    0x20400000, 0x10, 0x20404010, 0x400000,
    0x20004000, 0x404010, 0x400000, 0x20000010,
    0x400010, 0x20004000, 0x20000000, 0x4010,
    0x0, 0x400010, 0x20004010, 0x4000,
    0x404000, 0x20004010, 0x10, 0x20400010,
    0x20400010, 0x0, 0x404010, 0x20404000,
    0x4010, 0x404000, 0x20404000, 0x20000000,
    0x20004000, 0x10, 0x20400010, 0x404000,
    0x20404010, 0x400000, 0x4010, 0x20000010,
    0x400000, 0x20004000, 0x20000000, 0x4010,
    0x20000010, 0x20404010, 0x404000, 0x20400000,
    0x404010, 0x20404000, 0x0, 0x20400010,
    0x10, 0x4000, 0x20400000, 0x404010,
    0x4000, 0x400010, 0x20004010, 0x0,
    0x20404000, 0x20000000, 0x400010, 0x20004010,
};

const static unsigned int SP7[] = {
    0x200000, 0x4200002, 0x4000802, 0x0,
    0x800, 0x4000802, 0x200802, 0x4200800,
    0x4200802, 0x200000, 0x0, 0x4000002,
    0x2, 0x4000000, 0x4200002, 0x802,
    0x4000800, 0x200802, 0x200002, 0x4000800,
    0x4000002, 0x4200000, 0x4200800, 0x200002,
    0x4200000, 0x800, 0x802, 0x4200802,
    0x200800, 0x2, 0x4000000, 0x200800,
    0x4000000, 0x200800, 0x200000, 0x4000802,
    0x4000802, 0x4200002, 0x4200002, 0x2,
    0x200002, 0x4000000, 0x4000800, 0x200000,
    0x4200800, 0x802, 0x200802, 0x4200800,
    0x802, 0x4000002, 0x4200802, 0x4200000,
    0x200800, 0x0, 0x2, 0x4200802,
    0x0, 0x200802, 0x4200000, 0x800,
    0x4000002, 0x4000800, 0x800, 0x200002,
};

const static unsigned int SP8[] = {
    0x10001040, 0x1000, 0x40000, 0x10041040,
    0x10000000, 0x10001040, 0x40, 0x10000000,
    0x40040, 0x10040000, 0x10041040, 0x41000,
    0x10041000, 0x41040, 0x1000, 0x40,
    0x10040000, 0x10000040, 0x10001000, 0x1040,
    0x41000, 0x40040, 0x10040040, 0x10041000,
    0x1040, 0x0, 0x0, 0x10040040,
    0x10000040, 0x10001000, 0x41040, 0x40000,
    0x41040, 0x40000, 0x10041000, 0x1000,
    0x40, 0x10040040, 0x1000, 0x41040,
    0x10001000, 0x40, 0x10000040, 0x10040000,
    0x10040040, 0x10000000, 0x40000, 0x10001040,
    0x0, 0x10041040, 0x40040, 0x10000040,
    0x10040000, 0x10001000, 0x10001040, 0x0,
    0x10041040, 0x41000, 0x41000, 0x1040,
    0x1040, 0x40040, 0x10000000, 0x10041000,
};

#define IP(r,l) (l = rotr(l, 4)),   \
    (t = (l ^ r) & 0xf0f0f0f),	\
    (r ^= t), (l ^= t),     \
    (l = rotr(l, 12)),	    \
    (t = (l ^ r) & 0xffff), \
    (r ^= t), ( l ^= t),	\
    (l = rotl(l, 18)),	    \
    (t = (r ^ l) & 0xcccccccc), \
    (r ^= t), (l ^= t),     \
    (l = rotl(l, 6)),	    \
    (t = (r ^ l) & 0xff00ff00), \
    (r ^= t), (l ^= t),     \
    (l = rotr(l, 9)),	    \
    (t = (l ^ r) & 0x55555555), \
    (r ^= t), (l ^= t),     \
    (r = rotl(r, 1)),	    \
    (l = rotl(l, 2))

#define FP(l,r) (r = rotr(r, 1)),   \
    (t = (l ^ r) & 0xaaaaaaaa), \
    (r ^= t), (l ^= t),     \
    (l = rotr(l, 9)),	    \
    (t = (l ^ r) & 0xff00ff),	\
    (r ^= t), (l ^= t),     \
    (l = rotl(l, 6)),	    \
    (t = (l ^ r) & 0x33333333), \
    (r ^= t), (l ^= t),     \
    (l = rotl(l, 18)),	    \
    (t = (r ^ l) & 0xffff0000), \
    (r ^= t), (l ^= t),     \
    (l = rotr(l, 12)),	    \
    (t = (r ^ l) & 0xf0f0f0f0), \
    (r ^= t), (l ^= t),     \
    (l = rotr(l, 4))

#define ROUND(r, l, i) \
    (x	= rotr(r, 4) ^ ks->s[i]),   \
    (y	= r ^ ks->s[i+1]),	    \
    (l ^= SP7[ x		& 63]	\
	| SP8[ y		& 63]), \
    (l ^= SP5[(x >>  8) & 63]	    \
	| SP6[(y >>  8) & 63]),     \
    (l ^= SP3[(x >> 16) & 63]	    \
	| SP4[(y >> 16) & 63]),     \
    (l ^= SP1[(x >> 24) & 63]	    \
	| SP2[(y >> 24) & 63])

void des_encrypt(const des_key *ks,
    const unsigned char *pt, unsigned char *ct)
{
    unsigned int t, x, y, r, l;
    GETWORD(pt, l); GETWORD(pt+4, r);
    IP(r, l);
    ROUND(r, l, 0); ROUND(l, r, 2);
    ROUND(r, l, 4); ROUND(l, r, 6);
    ROUND(r, l, 8); ROUND(l, r, 10);
    ROUND(r, l, 12); ROUND(l, r, 14);
    ROUND(r, l, 16); ROUND(l, r, 18);
    ROUND(r, l, 20); ROUND(l, r, 22);
    ROUND(r, l, 24); ROUND(l, r, 26);
    ROUND(r, l, 28); ROUND(l, r, 30);
    FP(l, r);
    PUTWORD(ct, r); PUTWORD(ct+4, l);
}

void des_decrypt(const des_key *ks,
    const unsigned char *ct, unsigned char *pt)
{
    unsigned int t, x, y, r, l;
    GETWORD(ct, l); GETWORD(ct+4, r);
    IP(r, l);
    ROUND(r, l, 30); ROUND(l, r, 28);
    ROUND(r, l, 26); ROUND(l, r, 24);
    ROUND(r, l, 22); ROUND(l, r, 20);
    ROUND(r, l, 18); ROUND(l, r, 16);
    ROUND(r, l, 14); ROUND(l, r, 12);
    ROUND(r, l, 10); ROUND(l, r, 8);
    ROUND(r, l, 6); ROUND(l, r, 4);
    ROUND(r, l, 2); ROUND(l, r, 0);
    FP(l, r);
    PUTWORD(pt, r); PUTWORD(pt+4, l);
}
